import org.junit.jupiter.api.Test;
import saarland.cispa.sopra.*;
import saarland.cispa.sopra.systemtests.FieldInfo;

import java.io.File;
import java.util.HashMap;
import java.util.Map;

import org.junit.jupiter.api.BeforeAll;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import saarland.cispa.sopra.*;
import saarland.cispa.sopra.systemtests.FieldInfo;

import java.io.File;
import java.util.HashMap;
import java.util.Map;

public class WorldParserTest {
    @Test
    public void smallMapTest() {
        String map = "2\n2\nAA\nBB";
        Map<Character, Swarm> swarms = new HashMap<Character, Swarm>();
        Instruction[] brainA = new Instruction[1];
        Instruction[] brainB = new Instruction[1];
        brainA[0] = new Jump(0);
        brainB[0] = new Jump(0);
        Swarm swarmA = new Swarm('A', brainA, "A");
        Swarm swarmB = new Swarm('B', brainB, "B");
        swarms.put('A', swarmA);
        swarms.put('B', swarmB);

        World world = WorldParser.parseMap(map, 42, swarms);


        assert (world != null);
    }

    @Test
    public void bigMapTest() {
        String map = "8\n6\n........\n...BB...\n........\n........\n...AA...\n........";
        Map<Character, Swarm> swarms = new HashMap<Character, Swarm>();
        Instruction[] brainA = new Instruction[1];
        Instruction[] brainB = new Instruction[1];
        brainA[0] = new Jump(0);
        brainB[0] = new Jump(0);
        Swarm swarmA = new Swarm('A', brainA, "A");
        Swarm swarmB = new Swarm('B', brainB, "B");
        swarms.put('A', swarmA);
        swarms.put('B', swarmB);


        World world = WorldParser.parseMap(map, 42, swarms);
        assert (world != null);
    }

    @Test
    public void unevenMapTest() {
        String map = "5\n6\n.....\n...BB\n.....\n.....\nAA...\n.....";
        Map<Character, Swarm> swarms = new HashMap<Character, Swarm>();
        Instruction[] brainA = new Instruction[1];
        Instruction[] brainB = new Instruction[1];
        brainA[0] = new Jump(0);
        brainB[0] = new Jump(0);
        Swarm swarmA = new Swarm('A', brainA, "A");
        Swarm swarmB = new Swarm('B', brainB, "B");
        swarms.put('A', swarmA);
        swarms.put('B', swarmB);
        boolean fail = false;

        try {
            World world = WorldParser.parseMap(map, 42, swarms);
        } catch (IllegalArgumentException e) {
            fail = true;
        }
        assert (fail);
    }

    @Test
    public void emptyMapTest() {
        String map = "";
        Map<Character, Swarm> swarms = new HashMap<Character, Swarm>();
        Instruction[] brainA = new Instruction[1];
        Instruction[] brainB = new Instruction[1];
        brainA[0] = new Jump(0);
        brainB[0] = new Jump(0);
        Swarm swarmA = new Swarm('A', brainA, "A");
        Swarm swarmB = new Swarm('B', brainB, "B");
        swarms.put('A', swarmA);
        swarms.put('B', swarmB);
        boolean fail = false;

        try {
            World world = WorldParser.parseMap(map, 42, swarms);
        } catch (IllegalArgumentException e) {
            fail = true;
        }
        assert (fail);
    }

    @Test
    public void tooBigMapTest() {
        String map = "130\n130\n..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................\n" +
            "..................................................................................................................................";

        Map<Character, Swarm> swarms = new HashMap<Character, Swarm>();
        Instruction[] brainA = new Instruction[1];
        Instruction[] brainB = new Instruction[1];
        brainA[0] = new Jump(0);
        brainB[0] = new Jump(0);
        Swarm swarmA = new Swarm('A', brainA, "A");
        Swarm swarmB = new Swarm('B', brainB, "B");
        swarms.put('A', swarmA);
        swarms.put('B', swarmB);
        boolean fail = false;

        try {
            World world = WorldParser.parseMap(map, 42, swarms);
        } catch (IllegalArgumentException e) {
            fail = true;
        }
        assert (fail);
    }

    @Test
    public void invalidCharsMapTest() {
        String map = "2\n2\nA)\nB.";
        Map<Character, Swarm> swarms = new HashMap<Character, Swarm>();
        Instruction[] brainA = new Instruction[1];
        Instruction[] brainB = new Instruction[1];
        brainA[0] = new Jump(0);
        brainB[0] = new Jump(0);
        Swarm swarmA = new Swarm('A', brainA, "A");
        Swarm swarmB = new Swarm('B', brainB, "B");
        swarms.put('A', swarmA);
        swarms.put('B', swarmB);
        boolean fail = false;

        try {
            World world = WorldParser.parseMap(map, 42, swarms);
        } catch (IllegalArgumentException e) {
            fail = true;
        }
        assert (fail);
    }

    @Test
    public void wrongHeaderMapTest() {
        String map = "4\n4\n..\nAB";
        Map<Character, Swarm> swarms = new HashMap<Character, Swarm>();
        Instruction[] brainA = new Instruction[1];
        Instruction[] brainB = new Instruction[1];
        brainA[0] = new Jump(0);
        brainB[0] = new Jump(0);
        Swarm swarmA = new Swarm('A', brainA, "A");
        Swarm swarmB = new Swarm('B', brainB, "B");
        swarms.put('A', swarmA);
        swarms.put('B', swarmB);
        boolean fail = false;

        try {
            World world = WorldParser.parseMap(map, 42, swarms);

        } catch (IllegalArgumentException e) {
            fail = true;
        }
        assert (fail);
    }

    @Test
    public void variousMapTest() {
        String map = "4\n4\n.AA.\n1234\n====\n.BB.";
        Map<Character, Swarm> swarms = new HashMap<Character, Swarm>();
        Instruction[] brainA = new Instruction[1];
        Instruction[] brainB = new Instruction[1];
        brainA[0] = new Jump(0);
        brainB[0] = new Jump(0);
        Swarm swarmA = new Swarm('A', brainA, "A");
        Swarm swarmB = new Swarm('B', brainB, "B");
        swarms.put('A', swarmA);
        swarms.put('B', swarmB);

        World world = WorldParser.parseMap(map, 42, swarms);

        assert (world.getAnts().size() == 4);
        assert (world.getFieldAt(0, 0).getType() == '.');
        assert (world.getFieldAt(1, 0).getType() == 'A');
        assert (world.getFieldAt(1, 0).getAnt().get().getId() == 0);
        assert (world.getFieldAt(1, 3).getType() == 'B');
        assert (world.getFieldAt(0, 1).getType() == '.');
        assert (world.getFieldAt(1, 1).getType() == '.');
        assert (world.getFieldAt(2, 1).getType() == '.');
        assert (world.getFieldAt(3, 1).getType() == '.');
        assert (world.getFieldAt(0, 1).getFood() == 1);
        assert (world.getFieldAt(1, 1).getFood() == 2);
        assert (world.getFieldAt(2, 1).getFood() == 3);
        assert (world.getFieldAt(3, 1).getFood() == 4);
        FieldInfo field = world.getFieldAt(1, 1);
        field = (Normal) field;
        assert (((Normal) field).getIsNextToAntlion());
        assert (world.getFieldAt(0, 2).getType() == '=');
        assert (world.getFieldAt(0, 2).getType() == '=');
    }

    @Test
    public void basesNotConnectedMapTest() {
        String map = "4\n4\n....\n.AB.\n...A\n....";
        Map<Character, Swarm> swarms = new HashMap<Character, Swarm>();
        Instruction[] brainA = new Instruction[1];
        Instruction[] brainB = new Instruction[1];
        brainA[0] = new Jump(0);
        brainB[0] = new Jump(0);
        Swarm swarmA = new Swarm('A', brainA, "A");
        Swarm swarmB = new Swarm('B', brainB, "B");
        swarms.put('A', swarmA);
        swarms.put('B', swarmB);
        boolean fail = false;

        try {
            World world = WorldParser.parseMap(map, 42, swarms);

        } catch (IllegalArgumentException e) {
            fail = true;
        }
        assert (fail);
    }

    @Test
    public void inconsistentMapTest() {
        String map = "2\n2\nAC\n..";
        Map<Character, Swarm> swarms = new HashMap<Character, Swarm>();
        Instruction[] brainA = new Instruction[1];
        Instruction[] brainC = new Instruction[1];
        brainA[0] = new Jump(0);
        brainC[0] = new Jump(0);
        Swarm swarmA = new Swarm('A', brainA, "A");
        Swarm swarmB = new Swarm('C', brainC, "C");
        swarms.put('A', swarmA);
        swarms.put('C', swarmB);
        boolean fail = false;

        try {
            World world = WorldParser.parseMap(map, 42, swarms);
        } catch (IllegalArgumentException e) {
            fail = true;
        }
        assert (fail);
    }

    @Test
    public void pointMapTest() {
        String map = "4\n4\n....\n....\n....\n....";
        Map<Character, Swarm> swarms = new HashMap<Character, Swarm>();
        Instruction[] brainA = new Instruction[1];
        Instruction[] brainB = new Instruction[1];
        brainA[0] = new Jump(0);
        brainB[0] = new Jump(0);
        Swarm swarmA = new Swarm('A', brainA, "A");
        Swarm swarmB = new Swarm('B', brainB, "B");
        swarms.put('A', swarmA);
        swarms.put('B', swarmB);
        boolean fail = false;

        try {
            World world = WorldParser.parseMap(map, 42, swarms);

        } catch (IllegalArgumentException e) {
            fail = true;
        }
        assert (fail);
    }

    @Test
    public void toSmallMapTest() {
        String map = "0\n0\n";
        Map<Character, Swarm> swarms = new HashMap<Character, Swarm>();
        Instruction[] brainA = new Instruction[1];
        Instruction[] brainB = new Instruction[1];
        brainA[0] = new Jump(0);
        brainB[0] = new Jump(0);
        Swarm swarmA = new Swarm('A', brainA, "A");
        Swarm swarmB = new Swarm('B', brainB, "B");
        swarms.put('A', swarmA);
        swarms.put('B', swarmB);
        boolean fail = false;

        try {
            World world = WorldParser.parseMap(map, 42, swarms);

        } catch (IllegalArgumentException e) {
            fail = true;
        }
        assert (fail);
    }

    @Test
    public void weirdMapTest() {
        String map = "g\n-4\n....\nAA..\nBB..\n....";
        Map<Character, Swarm> swarms = new HashMap<Character, Swarm>();
        Instruction[] brainA = new Instruction[1];
        Instruction[] brainB = new Instruction[1];
        brainA[0] = new Jump(0);
        brainB[0] = new Jump(0);
        Swarm swarmA = new Swarm('A', brainA, "A");
        Swarm swarmB = new Swarm('B', brainB, "B");
        swarms.put('A', swarmA);
        swarms.put('B', swarmB);
        boolean fail = false;

        try {
            World world = WorldParser.parseMap(map, 42, swarms);

        } catch (IllegalArgumentException e) {
            fail = true;
        }
        assert (fail);
    }

    @Test
    public void bomberMapTest() {
        String map = "16\n8\n################\n123456789.......\n.....AA.........\n.......C........\n......AAA.......\n................\n......BBB.......\n................";
        Map<Character, Swarm> swarms = new HashMap<Character, Swarm>();
        Instruction[] brainA = new Instruction[1];
        Instruction[] brainC = new Instruction[1];
        brainA[0] = new Jump(0);
        brainC[0] = new Jump(0);
        Swarm swarmA = new Swarm('A', brainA, "A");
        Swarm swarmB = new Swarm('B', brainA, "B");
        Swarm swarmC = new Swarm('C', brainC, "C");
        swarms.put('A', swarmA);
        swarms.put('B', swarmB);
        swarms.put('C', swarmC);
        boolean fail = false;

        try {
            World world = WorldParser.parseMap(map, 42, swarms);
        } catch (IllegalArgumentException e) {
            fail = true;
        }
        assert (fail);
    }


    @Test
    public void smallWrongSwarmMapTest() {
        String map = "2\n2\n.A\nB.";
        Map<Character, Swarm> swarms = new HashMap<Character, Swarm>();
        Instruction[] brainG = new Instruction[1];
        Instruction[] brainB = new Instruction[1];
        brainG[0] = new Jump(0);
        brainB[0] = new Jump(0);
        Swarm swarmA = new Swarm('G', brainG, "G");
        Swarm swarmB = new Swarm('B', brainB, "B");
        swarms.put('A', swarmA);
        swarms.put('B', swarmB);
        boolean fail = false;

        try {
            World world = WorldParser.parseMap(map, 42, swarms);
        } catch (IllegalArgumentException e) {
            fail = true;
        }
        assert (fail);
    }


}

//inconsistenMap = 2\n2\nAC\n..






